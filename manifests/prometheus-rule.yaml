apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: driftguard-alerts
  namespace: driftguard
  labels:
    app: driftguard
spec:
  groups:
  - name: driftguard.rules
    rules:
    - alert: DriftGuardDown
      expr: up{job="driftguard"} == 0
      for: 2m
      labels:
        severity: critical
      annotations:
        summary: "DriftGuard is down"
        description: "DriftGuard has been down for more than 2 minutes."

    - alert: HighDriftRate
      expr: increase(driftguard_drift_total[10m]) > 10
      for: 5m
      labels:
        severity: warning
      annotations:
        summary: "High drift rate detected"
        description: "More than 10 drift events detected in the last 10 minutes."

    - alert: CriticalDriftDetected
      expr: driftguard_drift_by_severity{severity="critical"} > 0
      for: 1m
      labels:
        severity: critical
      annotations:
        summary: "Critical drift detected"
        description: "A critical drift event has been detected that requires immediate attention."

    - alert: HighRemediationFailureRate
      expr: (increase(driftguard_remediation_attempts_total{status="failed"}[10m]) / increase(driftguard_remediation_attempts_total[10m])) > 0.5
      for: 5m
      labels:
        severity: warning
      annotations:
        summary: "High remediation failure rate"
        description: "More than 50% of remediation attempts have failed in the last 10 minutes."

    - alert: DriftGuardRunDurationTooLong
      expr: histogram_quantile(0.95, rate(driftguard_run_duration_seconds_bucket[5m])) > 300
      for: 2m
      labels:
        severity: warning
      annotations:
        summary: "DriftGuard run duration too long"
        description: "The 95th percentile of DriftGuard run duration is over 300 seconds."

    - alert: DriftGuardErrorsIncreasing
      expr: increase(driftguard_errors_total[5m]) > 5
      for: 2m
      labels:
        severity: warning
      annotations:
        summary: "DriftGuard errors increasing"
        description: "More than 5 errors have occurred in the last 5 minutes."